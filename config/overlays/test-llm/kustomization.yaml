apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# This overlay extends the standard test overlay with LLM controller components
resources:
  - ../test
  - ../../llmisvc

patches:
  - path: llmisvc_manager_image_patch.yaml

# Add replacements for LLM webhook configurations
replacements:
  # Replace service name for LLM webhooks
  - source:
      fieldPath: metadata.name
      kind: Service
      name: kserve-llmisvc-controller-manager-service
      version: v1
    targets:
      - fieldPaths:
          - webhooks.*.clientConfig.service.name
        select:
          kind: ValidatingWebhookConfiguration
          name: llminferenceservice.serving.kserve.io
      - fieldPaths:
          - webhooks.*.clientConfig.service.name
        select:
          kind: ValidatingWebhookConfiguration
          name: llminferenceserviceconfig.serving.kserve.io
  # Replace namespace for LLM webhooks
  - source:
      fieldPath: metadata.namespace
      kind: Deployment
      name: kserve-llmisvc-controller-manager
      version: v1
    targets:
      - fieldPaths:
          - webhooks.*.clientConfig.service.namespace
        select:
          kind: ValidatingWebhookConfiguration
          name: llminferenceservice.serving.kserve.io
      - fieldPaths:
          - webhooks.*.clientConfig.service.namespace
        select:
          kind: ValidatingWebhookConfiguration
          name: llminferenceserviceconfig.serving.kserve.io
