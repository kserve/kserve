# Helm Mapping Configuration for KServe Chart
# Chart Name: kserve
# Description: KServe core inference service with optional localmodel support
# Source of truth: kustomize manifests in config/

# =============================================================================
# EXTENDS
# =============================================================================
# Include common/shared configurations from helm-mapping-common.yaml
# This file provides: common, localmodel
extends: helm-mapping-common.yaml

# =============================================================================
# CHART METADATA
# =============================================================================
metadata:
  name: kserve
  description: "KServe Predictive AI - Traditional ML and Deep Learning Model Serving Platform"
  version: "0.1.0"  # Overridden by KSERVE_VERSION from kserve-deps.env
  appVersion: "latest"  # Overridden by KSERVE_VERSION from kserve-deps.env

# =============================================================================
# GLOBALS (from kserve-deps.env)
# =============================================================================
globals:
  version:
    valuePath: kserve.version
    kserve-deps: KSERVE_VERSION

  chartVersion:
    valuePath: metadata.version
    kserve-deps: KSERVE_VERSION
    description: "Chart version from kserve-deps.env"

  chartAppVersion:
    valuePath: metadata.appVersion
    kserve-deps: KSERVE_VERSION
    description: "Chart appVersion from kserve-deps.env"

# =============================================================================
# KSERVE COMPONENT (main component for this chart)
# =============================================================================
kserve:
  enabled:
    valuePath: kserve.enabled
    description: "Enable KServe core inference service controller"

  manifestPath: config/components/kserve

  # KServe Controller Manager Deployment
  controllerManager:
    kind: Deployment
    name: kserve-controller-manager
    namespace: kserve
    manifestPath: config/manager/manager.yaml

    # Container-level fields (NEW structure with container-relative paths)
    containers:
      manager:  # Main container name
        image:
          repository:
            path: image+(:,0)
            valuePath: kserve.controller.containers.manager.image
          tag:
            path: image+(:,1)
            valuePath: kserve.controller.containers.manager.tag
            value: ""
            fallback: kserve.version
          pullPolicy:
            path: imagePullPolicy
            valuePath: kserve.controller.containers.manager.imagePullPolicy

        resources:
          path: resources
          valuePath: kserve.controller.containers.manager.resources

# =============================================================================
# NOTES
# =============================================================================
notes: |
  KServe Chart Mapping Configuration

  This chart includes:
  1. Common/base resources
  2. KServe core controller
  3. Optional localmodel controller

  Structure mirrors kustomize components:
  - config/base -> common resources
  - config/components/kserve -> kserve controller
  - config/components/localmodel -> localmodel controller

  Note: ClusterServingRuntimes are now provided in a separate
  kserve-runtime-configs chart for better modularity.

  Note: CRDs are managed separately via kserve-crd chart and Makefile.
